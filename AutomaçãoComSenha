#include <Keypad.h>
#include <Servo.h>
#include <LiquidCrystal.h>

LiquidCrystal lcd(A0, A1, A2, A3, A4, A5);
Servo servo;
const byte qtdLinhas = 4;
const byte qtdColunas = 4;

char matriz_teclas[qtdLinhas][qtdColunas] = {
  {'1', '2', '3', 'A'},
  {'4', '5', '6', 'B'},
  {'7', '8', '9', 'C'},
  {'*', '0', '#', 'D'}
};
byte Linhas[qtdLinhas] = {9,8,7,6}; //pinos utilizados nas linhas
byte Colunas[qtdColunas] = {5,4,3,2}; //pinos utilizados nas colunas

Keypad teclado = Keypad( makeKeymap(matriz_teclas), Linhas, Colunas, qtdLinhas, qtdColunas);
String senha;
boolean status = false;
 
void setup() {
  pinMode(13, OUTPUT);
  lcd.begin(16, 2);
  servo.attach(10);
  Serial.begin(9600);
  Serial.println("### MENU ###");
  Serial.println("PRESS '*' PARA CRIAR SENHA.");
  Serial.println("PRESS '#'Â´PARA ALTERAR SENHA.");
  Serial.println("PRESS 'A' PARA AUTENTICAR.");
  Serial.println();
 

}

void loop() {
  char tecla_pressionada = teclado.getKey();
  servo.write(90);
  lcd.setCursor(4, 0);
  lcd.print("BEM VINDO");
  
  if (tecla_pressionada == 'A') 
  {
    Serial.println();
    Serial.print("INFORME A SENHA: ");
    lcd.clear();
    lcd.setCursor(1, 1);
    lcd.print("INFORME A SENHA");
    String temp;
       while (true){
        char digito = teclado.getKey();
        if(digito) {
            Serial.print("*");
            lcd.clear();
            lcd.setCursor(3, 2);
            lcd.print("*");
            lcd.setCursor(4, 2);
            lcd.print("*");
            lcd.setCursor(5, 2);
            lcd.print("*");
            lcd.setCursor(6, 2);
            lcd.print("*");
            lcd.setCursor(7, 2);
            lcd.print("*");
            lcd.setCursor(8, 2);
            lcd.print("*");
            temp += digito;
        }
       if (temp.length() >=6) {
        if (temp == senha){
        Serial.println();
        Serial.print("PORTA ABERTA! ");
        lcd.clear();
        lcd.setCursor(2, 2);
        lcd.print("PORTA ABERTA");
        servo.write(180);
        delay(100);
        
        break;
       }
       else{
        Serial.println();
        Serial.println("SENHA INCORRETA");
        lcd.clear();
        lcd.setCursor(1, 2);
        lcd.print("SENHA INCORRETA");
        digitalWrite(13, HIGH);
        delay(2000);
        digitalWrite(13, LOW);
        break;
       }
       if (digito == '*'){
        break;
       }
    }   
  }
  }

  if(tecla_pressionada == '*'){
    Serial.print("INFORME A SENHA : ");
    lcd.clear();
    lcd.setCursor(1, 1);
    lcd.print("INFORME A SENHA");
    senha = "";
    while (true){
      char digito = teclado.getKey();
      if(digito){
        Serial.print("*");
            lcd.clear();
            lcd.setCursor(3, 2);
            lcd.print("*");
            lcd.setCursor(4, 2);
            lcd.print("*");
            lcd.setCursor(5, 2);
            lcd.print("*");
            lcd.setCursor(6, 2);
            lcd.print("*");
            lcd.setCursor(7, 2);
            lcd.print("*");
            lcd.setCursor(8, 2);
            lcd.print("*");
        senha += digito;
      }
      if (senha.length() >= 6){
        Serial.println();
        servo.write(180);
        Serial.println("FEITO");
        lcd.clear();
        lcd.setCursor(2, 2);
        lcd.print("SENHA SALVA");
        
        break;
      }
      if(digito == '*'){
        lcd.clear();
        lcd.setCursor(5, 2);
        lcd.print("*");
        senha = "";
        break;
      }
    }
  }
  if (tecla_pressionada == '#'){
    Serial.println();
    Serial.print("INFORME SUA SENHA");
    lcd.clear();
    lcd.setCursor(1, 0);
    lcd.print("INFORME SUA SENHA");
    String temp;
    while(true){
      char digito = teclado.getKey();
      if(digito){
        Serial.print("*");
        lcd.clear();
            lcd.setCursor(3, 2);
            lcd.print("*");
            lcd.setCursor(4, 2);
            lcd.print("*");
            lcd.setCursor(5, 2);
            lcd.print("*");
            lcd.setCursor(6, 2);
            lcd.print("*");
            lcd.setCursor(7, 2);
            lcd.print("*");
            lcd.setCursor(8, 2);
            lcd.print("*");
        temp += digito;
      }
      if (temp.length() >=6) {
        if (temp == senha) {
          Serial.println();
          Serial.print("INFORME A NOVA SENHA: ");
          lcd.clear();
          lcd.setCursor(1, 0);
          lcd.print("INFO NOVA SENHA");
          senha="";
          while (true) {
            char digito2 = teclado.getKey();
            if (digito2) {
              Serial.print("*");
              lcd.clear();
            lcd.setCursor(3, 2);
            lcd.print("*");
            lcd.setCursor(4, 2);
            lcd.print("*");
            lcd.setCursor(5, 2);
            lcd.print("*");
            lcd.setCursor(6, 2);
            lcd.print("*");
            lcd.setCursor(7, 2);
            lcd.print("*");
            lcd.setCursor(8, 2);
            lcd.print("*");
              senha += digito2;
            }
            if (senha.length() >=6) {
              Serial.println();
              Serial.println("SENHA ALTERADA");
              lcd.clear();
              lcd.setCursor(1, 2);
               lcd.print("SENHA ALTERADA");
              break;
            }
          }
          break;
        }
        else {
          Serial.println();
          Serial.println("SENHA INCORRETA!");
          lcd.clear();
          lcd.setCursor(1, 2);
          lcd.print("SENHA INCORRETA");
          break;
        }
      }
      if(digito == '*')
      {
        break;
      }
    }  
  }
}
